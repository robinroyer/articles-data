// Validating benchmarks:
No exporters defined, results will not be persisted.
// ***** BenchmarkRunner: Start   *****
// ***** Found 2 benchmark(s) in total *****
// ***** Building 1 exe(s) in Parallel: Start   *****
// start dotnet restore  /p:UseSharedCompilation=false /p:BuildInParallel=false /m:1 /p:Deterministic=true /p:Optimize=true in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575
// command took 1.88s and exited with 0
// start dotnet build -c Release  --no-restore /p:UseSharedCompilation=false /p:BuildInParallel=false /m:1 /p:Deterministic=true /p:Optimize=true in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575
// command took 4s and exited with 0
// ***** Done, took 00:00:06 (6 sec)   *****
// Found 1 benchmarks:
//   ForecastJobWithLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=500]

// **************************
// Benchmark: ForecastJobWithLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=500]
// *** Execute ***
// Launch: 1 / 1
// Execute: dotnet "c998c332-55d2-42ea-af26-ba8dcf9c3575.dll" --benchmarkName "ef_core_momory_cache_leak.ForecastJobWithLeak.Work(N: 500)" --job "IterationCount=1, RunStrategy=Monitoring" --benchmarkId 0 in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575/bin/Release/net6.0
Failed to set up high priority. Make sure you have the right permissions. Message: Permission denied
// BeforeAnythingElse

// Benchmark Process Environment Information:
// Runtime=.NET 6.0.1 (6.0.121.56705), X64 RyuJIT
// GC=Concurrent Server
// Job: Job-TXGBPG(IterationCount=1, RunStrategy=Monitoring)

WorkloadWarmup   1: 1 op, 3524945097.00 ns, 3.5249 s/op

// BeforeActualRun
WorkloadActual   1: 1 op, 3265274268.00 ns, 3.2653 s/op

// AfterActualRun
WorkloadResult   1: 1 op, 3265274268.00 ns, 3.2653 s/op
GC:  31 2 0 540118416 1
Threading:  6823 0 1

// AfterAll
// Benchmark Process 67283 has exited with code 0.

Mean = 3.265 s, StdErr = 0.000 s (0.00%), N = 1, StdDev = 0.000 s
Min = 3.265 s, Q1 = 3.265 s, Median = 3.265 s, Q3 = 3.265 s, Max = 3.265 s
IQR = 0.000 s, LowerFence = 3.265 s, UpperFence = 3.265 s
ConfidenceInterval = [NaN s; NaN s] (CI 99.9%), Margin = NaN s (NaN% of Mean)
Skewness = NaN, Kurtosis = NaN, MValue = 2

// ** Remained 1 benchmark(s) to run **
Run time: 00:00:11 (11.76 sec), executed benchmarks: 1

// Found 1 benchmarks:
//   ForecastJobWithoutLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=5]

// **************************
// Benchmark: ForecastJobWithoutLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=5]
// *** Execute ***
// Launch: 1 / 1
// Execute: dotnet "c998c332-55d2-42ea-af26-ba8dcf9c3575.dll" --benchmarkName "ef_core_momory_cache_leak.ForecastJobWithoutLeak.Work(N: 5)" --job "IterationCount=1, RunStrategy=Monitoring" --benchmarkId 1 in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575/bin/Release/net6.0
Failed to set up high priority. Make sure you have the right permissions. Message: Permission denied
// BeforeAnythingElse

// Benchmark Process Environment Information:
// Runtime=.NET 6.0.1 (6.0.121.56705), X64 RyuJIT
// GC=Concurrent Server
// Job: Job-QHCSRF(IterationCount=1, RunStrategy=Monitoring)


System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation.
 ---> System.ObjectDisposedException: Cannot access a disposed context instance. A common cause of this error is disposing a context instance that was resolved from dependency injection and then later trying to use the same context instance elsewhere in your application. This may occur if you are calling 'Dispose' on the context instance, or wrapping it in a using statement. If you are using dependency injection, you should let the dependency injection container take care of disposing context instances.
Object name: 'TodoContext'.
   at Microsoft.EntityFrameworkCore.DbContext.CheckDisposed()
   at Microsoft.EntityFrameworkCore.DbContext.AddAsync[TEntity](TEntity entity, CancellationToken cancellationToken)
   at ef_core_momory_cache_leak.ForecastJobWithoutLeak.Work() in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/backgroundJobs/ForecastJobWithoutLeak.cs:line 55
   at BenchmarkDotNet.Autogenerated.Runnable_1.<.ctor>b__3_3() in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575/c998c332-55d2-42ea-af26-ba8dcf9c3575.notcs:line 773
   at BenchmarkDotNet.Autogenerated.Runnable_1.WorkloadActionUnroll(Int64 invokeCount) in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575/c998c332-55d2-42ea-af26-ba8dcf9c3575.notcs:line 1267
   at BenchmarkDotNet.Engines.Engine.RunIteration(IterationData data)
   at BenchmarkDotNet.Engines.EngineStage.RunIteration(IterationMode mode, IterationStage stage, Int32 index, Int64 invokeCount, Int32 unrollFactor)
   at BenchmarkDotNet.Engines.EngineStage.Run(IStoppingCriteria criteria, Int64 invokeCount, IterationMode mode, IterationStage stage, Int32 unrollFactor)
   at BenchmarkDotNet.Engines.EngineWarmupStage.Run(Int64 invokeCount, IterationMode iterationMode, Int32 unrollFactor, RunStrategy runStrategy)
   at BenchmarkDotNet.Engines.EngineWarmupStage.RunWorkload(Int64 invokeCount, Int32 unrollFactor, RunStrategy runStrategy)
   at BenchmarkDotNet.Engines.Engine.Run()
   at BenchmarkDotNet.Autogenerated.Runnable_1.Run(IHost host, String benchmarkName) in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575/c998c332-55d2-42ea-af26-ba8dcf9c3575.notcs:line 754
   --- End of inner exception stack trace ---
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Span`1& arguments, Signature sig, Boolean constructor, Boolean wrapExceptions)
   at System.Reflection.RuntimeMethodInfo.Invoke(Object obj, BindingFlags invokeAttr, Binder binder, Object[] parameters, CultureInfo culture)
   at System.Reflection.MethodBase.Invoke(Object obj, Object[] parameters)
   at BenchmarkDotNet.Autogenerated.UniqueProgramName.AfterAssemblyLoadingAttached(String[] args) in /home/robin/code/Personnal/articles-data/ef-core-momory-cache-leak/bin/Release/net6.0/c998c332-55d2-42ea-af26-ba8dcf9c3575/c998c332-55d2-42ea-af26-ba8dcf9c3575.notcs:line 52
// AfterAll
// Benchmark Process 67346 has exited with code 255.
No more Benchmark runs will be launched as NO measurements were obtained from the previous run!


// ** Remained 0 benchmark(s) to run **
Run time: 00:00:01 (1.48 sec), executed benchmarks: 1

// ***** BenchmarkRunner: Finish  *****

// * Export *

// * Detailed results *
ForecastJobWithoutLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=5]
Runtime = .NET 6.0.1 (6.0.121.56705), X64 RyuJIT; GC = Concurrent Server
There are not any results runs

ForecastJobWithLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=500]
Runtime = .NET 6.0.1 (6.0.121.56705), X64 RyuJIT; GC = Concurrent Server
Mean = 3.265 s, StdErr = 0.000 s (0.00%), N = 1, StdDev = 0.000 s
Min = 3.265 s, Q1 = 3.265 s, Median = 3.265 s, Q3 = 3.265 s, Max = 3.265 s
IQR = 0.000 s, LowerFence = 3.265 s, UpperFence = 3.265 s
ConfidenceInterval = [NaN s; NaN s] (CI 99.9%), Margin = NaN s (NaN% of Mean)
Skewness = NaN, Kurtosis = NaN, MValue = 2
-------------------- Histogram --------------------
[3.265 s ; 3.265 s) | @
---------------------------------------------------

// * Summary *

BenchmarkDotNet=v0.13.1, OS=ubuntu 20.04
AMD Ryzen 5 PRO 2500U w/ Radeon Vega Mobile Gfx, 1 CPU, 8 logical and 4 physical cores
.NET SDK=6.0.101
  [Host]     : .NET 6.0.1 (6.0.121.56705), X64 RyuJIT
  Job-RPHPQY : .NET 6.0.1 (6.0.121.56705), X64 RyuJIT

IterationCount=1  RunStrategy=Monitoring  

|                   Type | Method |   N |    Mean | Error | Ratio | RatioSD |      Gen 0 |     Gen 1 |     Allocated |
|----------------------- |------- |---- |--------:|------:|------:|--------:|-----------:|----------:|--------------:|
| ForecastJobWithoutLeak |   Work |   5 |      NA |    NA |     ? |       ? |          - |         - |             - |
|                        |        |     |         |       |       |         |            |           |               |
|    ForecastJobWithLeak |   Work | 500 | 3.265 s |    NA |     ? |       ? | 31000.0000 | 2000.0000 | 540,118,416 B |

Benchmarks with issues:
  ForecastJobWithoutLeak.Work: Job-RPHPQY(IterationCount=1, RunStrategy=Monitoring) [N=5]

// * Legends *
  N         : Value of the 'N' parameter
  Mean      : Arithmetic mean of all measurements
  Error     : Half of 99.9% confidence interval
  Ratio     : Mean of the ratio distribution ([Current]/[Baseline])
  RatioSD   : Standard deviation of the ratio distribution ([Current]/[Baseline])
  Gen 0     : GC Generation 0 collects per 1000 operations
  Gen 1     : GC Generation 1 collects per 1000 operations
  Allocated : Allocated memory per single operation (managed only, inclusive, 1KB = 1024B)
  1 s       : 1 Second (1 sec)

// * Diagnostic Output - MemoryDiagnoser *


// ***** BenchmarkRunner: End *****
Global total time: 00:00:19 (19.35 sec), executed benchmarks: 2
// * Artifacts cleanup *
